<!DOCTYPE html>
<html>
    <head>
        <title>Gear.js - Build System for Node.js and the Browser</title>
        <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Economica" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" type="text/css" href="css/monokai.css" />
    </head>
    <body>
        <a href="https://github.com/yahoo/gear"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>

        <header>
            <h1>Gear.js</h1>
            <h2>Build System for Node.js and the Browser</h2>

            <!--<p class="watch"><iframe src="http://markdotto.github.com/github-buttons/github-btn.html?user=yahoo&amp;repo=gear&amp;type=watch&amp;count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="110px" height="20px"></iframe></p> -->
        </header>

        <article>
            <section id="intro">
                <p>Gear.js is an easy to use, simple to extend, and powerful build system. <strong>Chain tasks</strong> together to build projects with ease.</p>
                

                <div class="highlight">
                    <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

<pre><code class="code javascript">new Queue()
    .read('foo.js')
    .inspect()
    .jslint()
    .jsminify()
    .write('foo.min.js')
    .inspect()
    .run();</code><code class="result"></code></pre>
                </div>

                <h2>Features</h2>
                <ul>
                    <li>Basic building blocks that can be combined to perform complex builds.</li>
                    <li>Tasks are simply defined and keep system internals to a minimum.</li>
                    <li>Asynchronous execution.</li>
                    <li>Extensible task loading via NPM, file, or directory.</li>
                    <li>Advanced flow control for complex task execution.</li>
                    <li>Runs in Node.js and the browser.</li>
                </ul>
            </section>

            <section id="installation">
                <h2>Installation</h2>

                <h3>Node.js Install</h3>
                <p>To get the most out of Gear.js, install <a href="http://github.com/yahoo/gear-lib">gear-lib</a> which contains tasks for linting, minifying, and deploying JS/CSS assets.</p>
<div class="highlight"><pre><code class="bash">$ npm install gear gear-lib</code></pre></div>

                <p>Usage</p>

                <div class="highlight">
                    <pre><code class="javascript">var gear = require('gear');
new gear.Queue({registry: new gear.Registry({module: 'gear-lib'})}).log('test!').run();
</code><code class="result"></code></pre>
                </div>

                <h3>Browser Install</h3>

                <ul>
                    <li><a href="https://github.com/yahoo/gear/raw/master/build/gear.js">Development</a></li>
                    <li><a href="https://github.com/yahoo/gear/raw/master/build/gear.min.js">Production</a></li>
                </ul>

<div class="highlight"><pre><code class="html">&lt;script type=&quot;text/javascript&quot; src=&quot;https://github.com/yahoo/gear/raw/master/build/gear.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://github.com/yahoo/gear-lib/raw/master/build/gear-lib.js&quot;&gt;&lt;/script&gt;
</code></pre></div>

                <p>Usage (localStorage is used as a simple filesystem for read/write tasks)</p>

                <div class="highlight">
                    <pre><code class="javascript">require(['gear', 'gear-lib'], function(gear, lib) {
    new gear.Queue({registry: new gear.Registry({tasks: lib})}).log('test!').run();
});
</code><code class="result"></code></pre>
                </div>

                <h3>Source</h3>
                <ul>
                    <li><a href="http://github.com/yahoo/gear">gear</a> <img src="https://secure.travis-ci.org/twobit/gear.png" /></li>
                    <li><a href="http://github.com/yahoo/gear-lib">gear-lib</a> <img src="https://secure.travis-ci.org/twobit/gear-lib.png" /></li>
                </ul>
            </section>

            <section id="examples">
                <h2>Examples</h2>

                <h3>Execute Tasks On Multiple Items</h3>

                <div class="highlight">
                    <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                    <pre><code class="code javascript">new Queue()
    .read(['foo.js', {name: 'bar.js'}, 'baz.js'])
    .log('read files')
    .inspect()
    .write(['foo2.js', 'bar2.js']) // Not writing 'baz.js'
    .run();</code><code class="result"></code></pre>
                </div>

                <h3>Parallel Task Execution</h3>

                <div class="highlight">
                    <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                    <pre><code class="code javascript">new Queue()
    .read('foo.js')
    .log('Parallel Tasks')
    .tasks({
        read:     {task: ['read', ['bar.js', 'baz.js']]},
        combine:  {requires: 'read', task: 'concat'}, // Runs after read completes
        minify:   {requires: 'combine', task: 'jsminify'},
        print:    {requires: 'minify', task: 'inspect'},
        parallel: {task: ['log', "Hello Gear.js world!"]}, // Run parallel to read
        join:     {requires: ['parallel', 'print']} // Joined data is passed to next task in queue
     })
     .inspect()
     .run();</code><code class="result"></code></pre>
                </div>
            </section>

            <section id="docs">
                <h2>Documentation</h2>

                <h3>Queue</h3>
                <ul>
                    <li><a href="#Queue">Queue</a></li>
                    <li><a href="#Queue.task">Queue.task</a></li>
                    <li><a href="#Queue.run">Queue.run</a></li>
                </ul>

                <h3>Registry</h3>
                <ul>
                    <li><a href="#Registry">Registry</a></li>
                    <li><a href="#Registry.load">Registry.load</a></li>
                </ul>

                <h3>Tasks</h3>
                <ul>
                    <li><a href="#tasks.read">read</a></li>
                    <li><a href="#tasks.write">write</a></li>
                    <li><a href="#tasks.concat">concat</a></li>
                    <li><a href="#tasks.inspect">inspect</a></li>
                    <li><a href="#tasks.log">log</a></li>
                    <li><a href="#tasks.tasks">tasks</a></li>
                </ul>

                <h3><a href="#library">Library Tasks</a></h3>

                <h3><a href="#custom">Custom Tasks</a></h3>
                <h3><a href="#cli">CLI</a></h3>

                <div id="Queue">
                    <h3>Queue()</h3>
                    <h3>Queue(options)</h3>

                    <p>Queue constructor.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options - (Object) Options for queue.</li>
                        <li>options.logger - (Object) Logger instance, usually console.</li>
                        <li>options.registry - (Registry) Registry loaded with available tasks.</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .log('New queue')
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="Queue.task">
                    <h3>Queue.task(name)</h3>
                    <h3>Queue.task(name, options)</h3>

                    <p>Helper method to run the specified task. Preferred task execution style is to call the task directly i.e. <strong>inspect()</strong> instead of <strong>task('inspect')</strong>.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>name - (String) Name of task in registry.</li>
                        <li>options - Task specific options.</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .task('log', 'New queue')
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="Queue.run">
                    <h3>Queue.run()</h3>
                    <h3>Queue.run(callback)</h3>

                    <p>Runs the queue.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>callback - (Function(err, results)) Called on queue completion.</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .log('test')
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="Registry">
                    <h3>Registry()</h3>
                    <h3>Registry(options)</h3>

                    <p>Creates a new Registry instance. Registries contain available tasks.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options - See Registry.load.</li>
                    </ul>

                    <div class="highlight">
                        <pre><code class="code javascript">new Registry();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="Registry.load">
                    <h3>Registry.load(options)</h3>

                    <p>Load tasks from NPM module, directory, or file.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options.module - Module to load tasks from.</li>
                        <li>options.dirname - Directory to load tasks from.</li>
                        <li>options.filename - File to load tasks from.</li>
                        <li>options.tasks - Object to load tasks from. Format: {name0: fn0, ..., nameN: fnN}</li>
                    </ul>

                    <div class="highlight">
                        <pre><code class="code javascript">new Registry().load({dirname: 'foo'});</code><code class="result"></code></pre>
                    </div>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">var registry = new Registry({tasks: {
    counter: function(options, blob, done) {
        console.log(options + ' for ' + blob.name + ': ' + blob.result.length);
        done(null, blob);
    }
}});

new gear.Queue({registry: registry})
    .read(['foo.js', 'bar.js'])
    .counter('CHAR COUNT')
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="tasks.read">
                    <h3>read(name)</h3>
                    <h3>read(options)</h3>

                    <p>Appends file contents onto queue.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options.name - (String) Filename to read.</li>
                        <li>options.encoding - (String) bin (binary) or utf8 (default).</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .read('foo.js')
    .read(['foo.js', 'bar.js'])
    .read([{name: 'foo.js'}, {name: 'bar.js'}, {name: 'baz.js'}])
    .run(function(err, results) {
        console.log(('' + results[0]).length + ' characters');
    });</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="tasks.write">
                    <h3>write(name)</h3>
                    <h3>write(options)</h3>

                    <p>Write the blob to disk.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options.name - (String) File to write, will replace {checksum} with hash of blob content.</li>
                        <li>options.encoding - (String) bin (binary) or utf8 (default).</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .read('foo.js')
    .write('foo2.js')
    .write({name: 'foo3.js'})
    .inspect()
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="tasks.concat">
                    <h3>concat()</h3>
                    <h3>concat(callback)</h3>

                    <p>Concatenates blobs.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>callback - (Function) N/A.</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .read(['foo.js', 'bar.js'])
    .concat()
    .inspect()
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="tasks.inspect">
                    <h3>inspect()</h3>

                    <p>Inspects blobs.</p>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .read(['foo.js', 'bar.js'])
    .inspect()
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="tasks.log">
                    <h3>log(message)</h3>

                    <p>Log a message.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>message - (String) Message to log.</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">new Queue()
    .log('Hi')
    .run();</code><code class="result"></code></pre>
                    </div>
                </div>

                <div id="tasks.tasks">
                    <h3>tasks(workflow)</h3>

                    <h4>Arguments</h4>
                    <ul>
                        <li>workflow - (Object) Task workflow described below.</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">// label - Task instance name.
// label.task - Task name and optionally options.
// label.requires - List of labels that must be executed before this task runs.
new Queue()
    .read('foo.js')
    .tasks({
        dev:     {task: ['write', 'output.js']},
        prodmin: {task: 'jsminify'},
        prod:    {requires: 'prodmin', task: ['write', 'output.min.js']},
        join:    {requires: ['dev', 'prod']}
    })
    .run(function() {
        console.log('output.js - ' + localStorage['output.js'].length);
        console.log('output.min.js - ' + localStorage['output.min.js'].length);
    });</code><code class="result"></code></pre>
                        </div>

                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div id="library">
                    <h3>Library Tasks</h3>

                    <p><a href="http://github.com/yahoo/gear-lib">gear-lib</a> contains tasks such as:</p>

                    <ul>
                        <li>jslint</li>
                        <li>jsminify</li>
                        <li>csslint</li>
                        <li>cssminify</li>
                        <li>s3</li>
                        <li>handlebars</li>
                    </ul>

                    <h4>Node.js</h4>

                    <div class="highlight"><pre><code class="bash">$ npm install gear-lib</code></pre></div>

                    <h4>Browser</h4>

                    <ul>
                        <li><a href="https://github.com/yahoo/gear-lib/raw/master/build/gear-lib.js">Development</a></li>
                        <li><a href="https://github.com/yahoo/gear-lib/raw/master/build/gear-lib.min.js">Production</a></li>
                    </ul>

<div class="highlight"><pre><code class="html">&lt;script type=&quot;text/javascript&quot; src=&quot;https://github.com/yahoo/gear-lib/raw/master/build/gear-lib.js&quot;&gt;&lt;/script&gt;
</code></pre></div>
                </div>

                <div id="custom">
                    <h3>Custom Tasks</h3>

                    <p>Writing a task is especially easy compared to other Node.js build systems. Tasks operate on simple immutable blobs. The task returns a transformed blob via its callback.</p>


                    <h4>Arguments</h4>
                    <ul>
                        <li>options - Options for the task.</li>
                        <li>blob - Immutable blob.</li>
                        <li>done(err, result) - Callback executed when task is complete.</li>
                    </ul>

<div class="highlight"><pre><code class="javascript">// example.js
// Example task creates new blob containing `string`
exports.example = function(string, blob, done) {
    done(null, new blob.constructor(string)); // blob.constructor() is equivalent to Blob()
};
</code></pre></div>

                    <h4>Running Example Task</h4>

<div class="highlight"><pre><code class="javascript">new Queue({registry: new Registry({filename: 'example.js'})})
    .example('EXAMPLE')
    .run();
</code></pre></div>

                    <h4>Working With Blobs</h4>

                    <p>Blobs are loosely based on the <a href="http://www.w3.org/TR/FileAPI/#dfn-Blob">W3C Blob</a>.</p>

                    <ul>
                        <li>Immutable data object.</li>
                        <li>Contains a property bag as well as a private non-enumerable <em>result</em> property.</li>
                        <li>Blobs can be merged with other blobs. When merging, properties in the property bag are merged, while result is concatenated.</li>
                        <li><em>result</em> property can be Buffer or String.</li>
                    </ul>

                    <div class="highlight">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <pre><code class="code javascript">var b1 = new Blob('Hello');
console.log(b1);
var b2 = new Blob([b1, ' world!']);
console.log(b2);
var b3 = new Blob(b2, {name: 'TEST'});
console.log(b3.result + ' - ' + b3.name);
</code><code class="result"></code></pre>
                    </div>
                </div>


                <div id="cli">
                    <h3>CLI</h3>

                    <p>It's possible to execute a <a href="#tasks.tasks">tasks workflow</a> from the command line.</p>

                    <p>Create a file named <strong>Gearfile</strong> in your project directory. You can include executable Javascript in this file as long as it evaluates to an expression.</p>

                    <div class="highlight">
                        <pre><code class="code javascript">// Gearfile
{
    js:        {task: ['read', ['foo.js', 'bar.js', 'baz.js']]},
    js_concat: {requires: 'js', task: 'concat'},
    js_min:    {requires: 'js_concat', task: 'jsminify'}
    js_write:  {requires: 'js_min', task: ['write', 'foobarbaz.min.js']}

    css:       {task: ['read', 'xyz.css']},
    css_min:   {requires: 'css', task: 'cssminify'},
    css_write: {requires: 'css_min', task: ['write', 'xyz.min.css']}

    done:  {requires: ['js_write', 'css_write']}
}
</code><code class="result"></code></pre>
                    </div>

                    <p>Then run the gear command:</p>
                    <div class="highlight"><pre><code class="bash">$ gear</code></pre></div>

                    <p>If you have any require paths you will need to use an absolute path like so:</p>


                    <div class="highlight">
                        <pre><code class="code javascript">// Sample Gearfile
(function() {
    var path = require('path'),
        handlebars = require(path.join(process.cwd(), 'node_modules/handlebars')),
        template = handlebars.compile('&lt;h1&gt;{{msg}}&lt;h1&gt;');

    return {
        log:     {task: ['log', template({msg: 'Hello, world!'})]},
        join:    {requires: 'log'}
    };
})();
</code><code class="result"></code></pre>
                    </div>                    
                </div>
            </section>

            <section>
                <h2>Who's Using Gear.js</h2>
                <p><a href="http://github.com/yahoo/mojito-shaker">Mojito Shaker</a> by <a href="http://github.com/yahoo">Yahoo</a>.</p>
                <p><a href="http://github.com/yui/shifter">Shifter</a>, YUI builder by <a href="http://github.com/davglass">Dav Glass</a>.</p>
            </section>

            <section>
                <h2>Special Thanks</h2>
                <p>Gear.js takes inspiration from a few sources:</p>
                <ul>
                    <li><a href="http://github.com/mosen/buildy">buildy</a> created by <a href="http://github.com/mosen">mosen</a>.</li>
                    <li><a href="http://github.com/cowboy/grunt">grunt</a> created by <a href="http://github.com/cowboy">cowboy</a>.</li>
                </ul>
            </section>
        </section>
        </article>

        <footer>Copyright &copy; <script type="text/javascript">document.write(new Date().getFullYear());</script> Yahoo! Inc.</footer>

        <script type="text/javascript" src="js/highlight.min.js"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>

        <script type="text/javascript" src="http://yui.yahooapis.com/combo?3.5.1/build/yui/yui-min.js"></script>
        <script type="text/javascript" src="js/gear.js"></script>
        <script type="text/javascript" src="js/gear-lib.js"></script>

        <script type="text/javascript">
        require(['gear', 'gear-lib'], function(registry, gear, lib) {}); // Preload Gear.js

        YUI().use('event', 'event-move', function(Y) {
            ['foo', 'bar', 'baz'].forEach(function(name) {
                localStorage[name + '.js'] = 'var ' + name +  ' = function ' + name + '() { console.log("' + name + '"); };';
            });

            /*
            Y.one('#files').on('change', function(e) {
                var raw_files = e.currentTarget.getDOMNode().files;

                Array.prototype.forEach.call(raw_files, function(file) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        localStorage[file.name] = e.target.result;
                        files.push(file.name);
                    };

                    reader.onerror = function(e) {
                        alert("Can't read local files");
                    };

                    reader.readAsBinaryString(file);
                });
            });*/

            Y.all('.highlight button').on('gesturemovestart', function(e) {
                var example = e.currentTarget.get('parentNode');

                if (!example.hasClass('show')) {
                    var code = example.one('.code').get('text'),
                        result = example.one('.result'),
                        _console = window.console,
                        console = {
                            log: function(msg) {
                                if (_console) {_console.log(msg);}
                                if (result) {
                                    result.setHTML(result.getHTML() + '<span>&gt;</span> ' + msg + '<br />');
                                }
                            },
                            error: function(msg) {
                                if (_console) {_console.error(msg);}
                                if (result) {
                                    result.setHTML(result.getHTML() + '<span>&gt;</span> ' + msg + '<br />');
                                }
                            }
                        },
                        gear = require('gear'),
                        Registry = gear.Registry,
                        Blob = gear.Blob,
                        Queue = (gear.Queue).bind(this, {registry: new Registry({tasks: require('gear-lib')}), logger: console});

                    result.setHTML('');

                    var ret = eval(code);
                    if (ret !== undefined) {console.log(ret);}
                }

                example.toggleClass('show');
            });
        });
        </script>
    </body>
</html>
